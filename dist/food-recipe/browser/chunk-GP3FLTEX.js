import{T as g,_ as k,d as m,e as a,g as s,j as l,k as d,m as u}from"./chunk-WB7VSCDF.js";var o=class{constructor(r,f,t,e){this.email=r,this.id=f,this._token=t,this._tokenExpirationDate=e}get token(){return!this._tokenExpirationDate||new Date>this._tokenExpirationDate?null:this._token}};var h={production:!0,firebaseAPIKey:"AIzaSyDg-rH13pV8IJBlGrGs4seJ2fUF2YQroLg"};var v=(()=>{let r=class r{constructor(t,e){this.http=t,this.router=e,this.user=new m(null),this.token=null}signup(t,e){return this.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/signupNewUser?key="+h.firebaseAPIKey,{email:t,password:e,returnSecureToken:!0}).pipe(s(this.handleError),l(i=>{this.handleAuthentication(i.email,i.localId,i.idToken,+i.expiresIn)}))}login(t,e){return this.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/verifyPassword?key="+h.firebaseAPIKey,{email:t,password:e,returnSecureToken:!0}).pipe(s(this.handleError),l(i=>{this.handleAuthentication(i.email,i.localId,i.idToken,+i.expiresIn)}))}logout(){this.user.next(null),this.router.navigate(["/auth"]),localStorage.removeItem("userData"),this.tokenExpirationTimer&&clearTimeout(this.tokenExpirationTimer),this.tokenExpirationTimer=null}autoLogout(t){this.tokenExpirationTimer=setTimeout(()=>{this.logout()},t)}autoLogin(){let t=JSON.parse(localStorage.getItem("userData"));if(!t)return;let e=new o(t.email,t.id,t._token,new Date(t._tokenExpirationDate));if(e.token){this.user.next(e);let i=new Date(t._tokenExpirationDate).getTime()-new Date().getTime();this.autoLogout(i)}}handleAuthentication(t,e,i,p){let w=new Date(new Date().getTime()+ +p*1e3),c=new o(t,e,i,w);this.user.next(c),this.autoLogout(p*1e3),localStorage.setItem("userData",JSON.stringify(c))}handleError(t){let e="Unknown error has occurred.";if(!t.error||!t.error.error)return a(e);switch(t.error.error.message){case"EMAIL_EXISTS":e="The email already exists in the system.";break;case"EMAIL_NOT_FOUND":e="The email not found in the system.";break;case"INVALID_PASSWORD":e="The password is not valid.";break;case"INVALID_LOGIN_CREDENTIALS":e="Login credentail is not valid.";break}return a(e)}};r.\u0275fac=function(e){return new(e||r)(u(g),u(k))},r.\u0275prov=d({token:r,factory:r.\u0275fac,providedIn:"root"});let n=r;return n})();export{v as a};
